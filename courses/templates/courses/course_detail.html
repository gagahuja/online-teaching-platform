{% extends "courses/base.html" %}
{% block content %}

<div class="container mt-4">

    <h2>{{ course.title }}</h2>
    <hr>

    <!-- Progress -->
    <div class="progress-bar bg-success"
        role="progressbar"
        data-progress="{{ progress_percent }}">
        {{ progress_percent }}%
    </div>

    <!-- Modules -->
    <h4>ðŸ“˜ Modules</h4>

    {% if modules %}
        <ul class="list-group mb-4">
            {% for module in modules %}
                <li class="list-group-item d-flex justify-content-between align-items-center">

                    <div>
                        <input type="checkbox"
                            class="module-checkbox"
                            data-module-id="{{ module.id }}"
                            {% if module.id in completed_modules %}checked{% endif %}>
                        {{ module.order }}. {{ module.title }}
                    </div>

                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No modules added.</p>
    {% endif %}

    <!-- Sessions -->
    <h4>ðŸŽ¥ Sessions</h4>

    {% if sessions %}
        <ul class="list-group">
            {% for session in sessions %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        {{ session.title }} â€”
                        {{ session.scheduled_date }}
                        {{ session.start_time }}
                    </span>

                    {% if session.is_active %}
                        <a href="{% url 'live_class' session.id %}"
                           class="btn btn-success btn-sm">
                            Join Live
                        </a>
                    {% else %}
                        <span class="badge bg-secondary">Not Live</span>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No sessions scheduled.</p>
    {% endif %}

</div>


<script>
document.addEventListener("DOMContentLoaded", function() {

    const checkboxes = document.querySelectorAll(".module-checkbox");

    checkboxes.forEach(function(box) {
        box.addEventListener("change", function() {

            const moduleId = this.dataset.moduleId;

            fetch(`/toggle-module/${moduleId}/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                }
            })
            .then(response => response.json())
            .then(data => {

                // Update progress bar
                const progressBar = document.querySelector(".progress-bar");
                progressBar.style.width = data.progress_percent + "%";
                progressBar.innerText = data.progress_percent + "%";

            });

        });
    });

});
</script>
{% endblock %}